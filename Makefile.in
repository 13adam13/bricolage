# settings
SHELL = /bin/sh

# Programatic dependancies
PERL = @PERL@
APACHE = @APACHE@
POSTGRESHOME = @PGHOME@
POD2HTML = @POD2HTML@
POD2TEXT = @POD2TEXT@
POD2MAN = @POD2MAN@
GZIP = @GZIP@
MKDIR = @MKDIR@
FIND = @FIND@
CTAGS = @CTAGS@

# directories
BIN = bin
COMP = comp
CONF = conf
DATA = data
LIB = lib
DOC = doc
INST = install

# Installation related variables
prefix  = @prefix@
exec_prefix  = @exec_prefix@
bindir  = @bindir@
datadir  = @datadir@
sysconfdir  = @sysconfdir@
libdir  = @libdir@
libexecdir  = @libexecdir@
includedir  = @includedir@
oldincludedir  = @oldincludedir@
mandir  = @mandir@
infodir  = @infodir@
sbindir  = @sbindir@
localstatedir  = @localstatedir@
sharedstatedir  = @sharedstatedir@
VPATH = @srcdir@
BIN_FILES = $(shell cd ${BIN} && ls | sed -e 's/CVS//')
BIN_TARGETS = $(addprefix ${bindir},${BIN_FILES})
CONF_TARGETS = 
COMP_TARGETS = 
DATA_TARGETS = 
LIB_TARGETS = 
DOC_TARGETS = 
NORMAL_INSTALL = ${BIN_TARGETS} ${COMP_TARGETS} \
				 ${CONF_TARGETS} ${DATA_TARGETS} \
				 ${LIB_TARGETS} ${DOC_TARGETS}
PRE_INSTALL = :
POST_INSTALL = :
NORMAL_UNINSTALL = :
PRE_UNINSTALL = :
POST_UNINSTALL = :

# Bricolage configuration info
APACHE_USER = @APACHE_USER@
APACHE_GROUP = @APACHE_GROUP@
DB_NAME = @DB_NAME@
DBI_USER = @DBI_USER@
DBI_PASS = @DBI_PASS@
POSTGRES_ROOT_USER = @POSTGRES_ROOT_USER@
POSTGRES_ROOT_PASS = @POSTGRES_ROOT_PASS@

# A list of any missing modules
MISSING_MODULES = @MISSING_MOD@
MODULE_COMMAND = $(foreach mod,${MISSING_MODULES},${PERL} -MCPAN -e "install ${mod}" ;)

all:  doc

install: dep installdirs install-bin install-comp \
		 install-conf install-data install-lib install-doc \
		 install-man install-html
installdirs:
	${INST}/mkinstalldirs 	${prefix} ${exec_prefix} \
							${bindir} ${datadir} \
							${sysconfdir} ${libdir} \
							${libexecdir} ${includedir} \
							${oldincludedir} ${mandir} \
							${infodir} ${sbindir} \
							${localstatedir} ${sharedstatedir} \
							${compdir} ${docdir} \
							${htmldir} ${mandir}
install-bin: ${BIN_TARGETS}
${BIN_TARGETS}: ORIG = $(filter ${BIN_FILES})
${BIN_TARGETS}: ${ORIG}
	cp ${BIN}/${ORIG} ${bindir}
install-comp:
install-conf:
install-data:
install-lib:
install-doc:
install-man:
install-html:



dep: cpan

cpan:
	${INSTALL_MISSING}
	echo Installed ${MISSING_MODULES} >>install.log



doc: Changes INSTALL TODO License
	cd ${DOC} && ${MAKE} -e

INSTALL:
	${POD2TEXT} lib/Bric/Admin.pod >$@

TODO:
	${POD2TEXT} lib/Bric/ToDo.pod >$@

Changes:
	${POD2TEXT} lib/Bric/Changes.pod >$@

License:
	${POD2TEXT} lib/Bric/License.pod >$@



# TODO: Make this recursively generate tags files in all directories
tags:
ifdef CTAGS
	${CTAGS} -R
endif



clean: docclean
	${RM} -f Changes INSTALL TODO License tags


docclean:
	cd $(DOC) && ${MAKE} -e clean


.PHONY : clean dep clean cpan doc install installdirs \
		 install-bin install-comp install-conf install-data \
		 install-lib install-doc install-html install-man
