-- Project: Bricolage
-- VERSION: $LastChangedRevision$
--
-- $LastChangedDate$
-- Target DBMS: PostgreSQL 7.1.2
-- Author: Michael Soderstrom <miraso@pacbell.net>
--

ALTER TABLE media
ADD CONSTRAINT fk_source__media FOREIGN KEY (source__id)
	REFERENCES source(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_usr__media FOREIGN KEY (usr__id)
	REFERENCES usr(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_element__media FOREIGN KEY (element__id)
	REFERENCES element(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_workflow__media FOREIGN KEY (workflow__id)
	REFERENCES workflow(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_site__media FOREIGN KEY (site__id)
	REFERENCES site(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_media__media_id FOREIGN KEY (alias_id)
	REFERENCES media(id) ON DELETE RESTRICT;

ALTER TABLE media
ADD CONSTRAINT fk_desk__media FOREIGN KEY (desk__id)
	REFERENCES desk(id) ON DELETE RESTRICT;

-- -----------------------------------------------------------------------------
-- Table media_instance

ALTER TABLE media_instance
ADD CONSTRAINT fk_media_version__media_instance FOREIGN KEY (media_version__id)
	REFERENCES media_version(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Table media_version

ALTER TABLE media_version
ADD CONSTRAINT fk_media__media_version FOREIGN KEY (media__id)
	REFERENCES media(id) ON DELETE CASCADE;
	
ALTER TABLE media_version
ADD CONSTRAINT fk_category__media_instance FOREIGN KEY (category__id)
	REFERENCES category(id) ON DELETE CASCADE;

ALTER TABLE media_version
ADD CONSTRAINT fk_media_type__media_instance FOREIGN KEY (media_type__id)
	REFERENCES media_type(id) ON DELETE CASCADE;

ALTER TABLE media_version
ADD CONSTRAINT fk_usr__media_version FOREIGN KEY (usr__id)
	REFERENCES usr(id) ON DELETE CASCADE;

ALTER TABLE media_version
ADD CONSTRAINT fk_primary_oc__media_version FOREIGN KEY (primary_oc__id)
	REFERENCES output_channel(id) ON DELETE CASCADE;

ALTER TABLE media_version
ADD CONSTRAINT fk_primary_ic__media_version FOREIGN KEY (primary_ic__id)
	REFERENCES input_channel(id) ON DELETE CASCADE;
	
-- -----------------------------------------------------------------------------
-- Table media_uri

ALTER TABLE media_uri
ADD CONSTRAINT fk_media__media_uri FOREIGN KEY (media__id)
    REFERENCES media(id) ON DELETE CASCADE;

ALTER TABLE media_uri
ADD CONSTRAINT fk_media__site__id FOREIGN KEY (site__id)
REFERENCES site(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Media to output channel mapping constraints
ALTER TABLE media__output_channel 
ADD CONSTRAINT fk_media__oc__media FOREIGN KEY (media_version__id)
	REFERENCES media_version(id) ON DELETE CASCADE;

ALTER TABLE media__output_channel 
ADD CONSTRAINT fk_media__oc__oc FOREIGN KEY (output_channel__id)
	REFERENCES output_channel(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Media to input channel mapping constraints
ALTER TABLE media__input_channel 
ADD CONSTRAINT fk_media__ic__media FOREIGN KEY (media_version__id)
	REFERENCES media_version(id) ON DELETE CASCADE;

ALTER TABLE media__input_channel 
ADD CONSTRAINT fk_media__ic__ic FOREIGN KEY (input_channel__id)
	REFERENCES input_channel(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Table: media_member

ALTER TABLE    media_member
ADD CONSTRAINT fk_media__media_member FOREIGN KEY (object_id)
REFERENCES     media(id) ON DELETE CASCADE;

ALTER TABLE    media_member
ADD CONSTRAINT fk_member__media_member FOREIGN KEY (member__id)
REFERENCES     member(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Table: attr_media

-- -----------------------------------------------------------------------------
-- Table: attr_media_val


ALTER TABLE attr_media_val ADD 
    CONSTRAINT fk_attr_media__attr_media_val FOREIGN KEY (attr__id)
    REFERENCES attr_media(id) ON DELETE CASCADE;

ALTER TABLE attr_media_val ADD
    CONSTRAINT fk_media__attr_media_val FOREIGN KEY (object__id)
    REFERENCES media(id) ON DELETE CASCADE;

-- -----------------------------------------------------------------------------
-- Table: attr_media_meta

ALTER TABLE attr_media_meta ADD 
    CONSTRAINT fk_attr_media__attr_media_meta FOREIGN KEY (attr__id)
    REFERENCES attr_media(id) ON DELETE CASCADE;



