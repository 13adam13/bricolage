% if ($type eq 'cont_') {
    <li id="subelement_con<% $subelem->get_id %>" class="container clearboth">
    <& 'container.mc',
        widget  => $widget,
        element => $subelem
    &>
    </li>
% } else {
    <li id="subelement_dat<% $subelem->get_id %>" class="element clearboth">
    <& 'field.mc',
        widget  => $widget,
        element => $subelem
    &>
    </li>
% }

<%once>
my $widget = 'container_prof';
</%once>

<%init>
my $element = get_state_data($widget, 'element');
my $container_id = $ARGS{"$widget|add_element_container"};
my $field = $ARGS{"$widget|add_element_to_$container_id"} || $ARGS{"$widget|add_element"};

# Find the right subelement to add the new element to
$element = (grep { $_->get_id == $container_id } $element->get_containers)[0] 
    if $container_id && $element->get_id != $container_id;

my ($type, $id) = unpack('A5 A*', $field);
    
my $subelem = ($type eq 'cont_') ? $element->add_container(Bric::Biz::ElementType->lookup({ id => $id }))
                                 : $element->add_field(Bric::Biz::ElementType::Parts::FieldType->lookup({ id => $id }));
$element->save();
</%init>

<%flags>
inherit => undef
</%flags>