<input type="hidden" name="select_time|refresh_cb" value="<% $base_name %>">
<%perl>;
$m->out(q{<table border="0" cellpadding="0" cellspacing="0" width="574">
	    <tr>}) if ($useTable);

# Print out a display label if necessary
if ($disp && !$compact) {
    $m->out(qq{<td align="right" width="$indent">}) if ($useTable);
    $m->out(qq{<span class="label">} . $lang->maketext($disp) . ':</span>&nbsp;');
    $m->out(qq{<img src="/media/images/spacer.gif" width="$indent"},
            qq{height="1" border="0" /></td>}) if $useTable;
} else {
    $m->out(qq{<td>
	       <img src="/media/images/spacer.gif" width=$indent height=1 />
	       </td>}) if ($useTable);
}

if (!$useTable) {$compact = 1};

#-- Month Select
if ($mon) {
    $mk_time_field->({'base'    => $base_name.'_mon',
		      'default' => $s->{'mon'},
		      'label'   => 'Month',
		      'vals'    => \@month,
		      'width'   => $cellWidth,
		      'compact' => $compact});
    $cellsDisplayed++;
}

#-- Day Select
if ($day) {
    $mk_time_field->({'base'    => $base_name.'_day',
		      'default' => $s->{'day'},
		      'label'   => 'Day',
		      'localize'=> 0,
		      'vals'    => $day,
		      'width'   => $cellWidth,
		      'compact' => $compact});
    $cellsDisplayed++;
}

#-- Year Select
if ($year) {
    $mk_time_field->({'base'    => $base_name.'_year',
		      'default' => $s->{'year'},
		      'label'   => 'Year',
		      'vals'    => $year,
		      'localize'=> 0,
		      'width'   => $cellWidth,
		      'compact' => $compact});
    $cellsDisplayed++;
}

#-- Hour Select
if ($hour) {
    $mk_time_field->({'base'    => $base_name.'_hour',
		      'default' => $s->{'hour'},
		      'label'   => 'Hour',
		      'localize'=> 0,
		      'vals'    => $hour,
		      'width'   => $cellWidth,
		      'compact' => $compact});
    $cellsDisplayed++;
}

#-- Minute Select
if ($min) {
    $mk_time_field->({'base'    => $base_name.'_min',
		      'default' => $s->{'min'},
		      'label'   => 'Minute',
                      'localize' => 0,
		      'vals'    => $min,
		      'width'   => $cellWidth,
		      'compact' => $compact});
    $cellsDisplayed++;
}

#-- Second Select
if ($sec) {
    $mk_time_field->({base     => "$base_name\_sec",
		      default  => $s->{sec},
		      label    => 'Second',
                      localize => 0,
		      vals     => $sec,
		      width    => $cellWidth,
		      compact  => $compact});
    $cellsDisplayed++;
}

if ($mil || $mic) {
    my ($key, $label, $size) = $mic
      ? qw(mic Microseconds 6)
      : qw(mil Milliseconds 3);
    $m->print(qq{<td width="$cellWidth" valign="top">}
              . qq{<span class="label">$label</span><br />}) unless $compact;
    $m->comp('/widgets/profile/text.mc',
             length    => $size,
             maxlength => $size,
             useTable  => 0,
             name      => "$base_name\_$key",
             value     => $s->{$key} || '0',
         );
    $m->print('</td>') unless $compact;
    $cellsDisplayed++;
}

# End the table unless this is a compact listing.
unless ($compact) {
    # make a cell to use the remaining space, so Netscape can do the right thing
    $m->out("<td width=" .( 574 - $cellsDisplayed * $cw - $indent) . ">&nbsp;</td>");
    $m->out(q{</tr></table>});
}
</%perl>
<%args>
$s
$widget
$base_name
$year     => ''
$mon      => ''
$day      => ''
$hour     => ''
$min      => ''
$sec      => ''
$mil      => ''
$mic      => ''
$formName => "forms[0]"
$indent   => undef
$useTable => 0
$compact  => undef
$disp     => ''
</%args>
<%once>;
my @mon_names = qw(Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec);
my $mk_time_field = sub {
    my ($p) = @_;
    $p->{label} = $lang->maketext($p->{label});

    $m->print(qq{<td width="$p->{width}" valign="top">}
              . qq{<span class="label">$p->{label}</span><br />}) unless $p->{compact};

    $m->comp('/widgets/profile/select.mc',
             'name'     => $p->{base},
             'value'    => $p->{default},
             'options'  => [ [ '-1' , $p->{label}], @{$p->{vals}} ],
             'useTable' => 0,
             'localize'=> $p->{localize});

    $m->print('</td>') unless $p->{compact};
};
</%once>
<%init>;
my $js;
my $agent = detect_agent();
my $cw = '80';
my $cellWidth = "width=$cw";
my $cellsDisplayed = 0;
$useTable = 0 if $compact;
$indent = $useTable ? FIELD_INDENT + 3 : 0 unless defined $indent;
$indent -= 7 if $agent->nav4;

my @month = map { [$_,$lang->maketext($mon_names[$_-1])] } ('01'..'12');

if ($year && $mon && $day ) {
    $js = qq{ onchange="setDays('$base_name\_year', '$base_name\_mon', }
      . qq{'$base_name\_day', this)"};
}
</%init>
