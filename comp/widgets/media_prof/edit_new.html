<%perl>;
$m->comp("/widgets/wrappers/sharky/table_top.mc",
  	 caption => "Properties",
	 number  => 1);

my $wf = Bric::Biz::Workflow->lookup
  ({ id => get_state_data($widget, 'work_id')});
my $site_id = $wf->get_site_id;

$m->comp('/widgets/profile/displayFormElement.mc',
         key => 'site',
         readOnly => 1,
         objref => $wf
        );

$m->comp('/widgets/profile/displayFormElement.mc',
	 key => 'title',
	 vals => $nmeth
	);
</%perl>
<& '/widgets/select_object/select_object.mc',
	disp => 'Media Type',
	name => "$widget|at_id",
	object => 'element_type',
	field => 'name',
        default    => ['' , ''],
        req => 1,
        constrain  => { top_level => 1,
			media => 1,
                        site_id => $site_id },
        exclude  => $excl_sub,
	useTable   => 1
&>
<& '/widgets/select_object/select_object.mc',
	disp => 'Source',
	object => 'source',
	name => "$widget|source__id",
	field => 'source_name',
	useTable => 1
&>
<& '/widgets/select_object/select_object.mc',
	object		=> 'category',
	disp		=> 'Category',
	name		=> "$widget|category__id",
	field		=> 'uri',
        req             => 1,
	sort_field      => 'uri',
        constrain       => { site_id => $site_id },
        exclude         => $excl_sub,
	useTable	=> 1
&>
<&'/widgets/profile/displayFormElement.mc',
	 key => "priority",
	 vals => $pmeth,
&>
<&'/widgets/profile/displayFormElement.mc',
	 key => "cover_date",
	 vals => $cdate,
&>

    <div class="row">
      <div class="label">File:</div>
      <div class="input"><input type="file" name="<% $widget %>|file" /></div>
    </div>

<& '/widgets/wrappers/sharky/table_bottom.mc' &>
<& '/widgets/profile/button.mc',
         disp   => $lang->maketext('Create'),
         widget => $widget,
         cb     => 'create_cb',
         button => 'create_red',
         useTable => 0
&>
<%once>;
my $pmeth = { %{ Bric::Biz::Asset::Business::Media->my_meths->{priority} } };
$pmeth->{value} = 3;
my $cdate = { %{ Bric::Biz::Asset::Business::Media->my_meths->{cover_date} } };
my $nmeth = Bric::Biz::Asset::Business::Media->my_meths->{title};
my $excl_sub = sub { ! chk_authz($_[0], READ, 1) };
</%once>
<%args>
$widget
$media
</%args>
<%init>;
$cdate->{value} = strfdate();
</%init>
