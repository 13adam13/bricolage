<%perl>
my $rightText = $m->scomp( '/widgets/profile/imageSubmit.mc',
  formName => "theForm",
  callback => $widget . "|trail_cb",
  image    => "view_trail_teal"
) . '&nbsp;';

$rightText .= $m->scomp( '/widgets/profile/imageSubmit.mc',
  formName => "theForm",
  callback => $widget . "|notes_cb",
  value    => 'view',
  image    => $media->has_notes ? 'note_fill' : "note",
  useGlobalImage => 1,
);

$m->comp("/widgets/wrappers/sharky/table_top.mc",
  	 caption => "Information",
	 number  => $num++,
         id        => 'mediainfo',
	 rightText => $rightText

);
</%perl>

<dl class="viewmeta">
  <dt><%$lang->maketext('UUID')%>:</dt>
  <dd><% $media->get_uuid %></dd>
  <dt><% $lang->maketext('Element')%>:</dt>
  <dd><% $media->get_element_name %></dd>
  <dt><% $lang->maketext('Title') %>:</dt>
  <dd><% $media->get_title %></dd>
  <dt><%$lang->maketext('URI') %>:</dt>
% if ($media->get_file_name) {
  <dd><% $m->comp('/widgets/profile/preview_link.mc',
                   type  => 'media',
                   value => $media->get_primary_uri,
                   doc   => $media,
                   style => 'blackUnderlinedLink') %></dd>
% } else {
  <dd>&nbsp;</dd>
% }
  <dt><% $lang->maketext('Source') %>:</dt>
  <dd><% Bric::Biz::Org::Source->lookup({ id => $media->get_source__id })->get_source_name %></dd>
  <dt><% $lang->maketext('Description') %>:</dt>
  <dd><% $media->get_description || '&nbsp;' %></dd>
  <dt><% $lang->maketext('Current Version') %>:</dt>
  <dd><% $media->get_version() %></dd>
  <dt><% $lang->maketext('Published Version') %>:</dt>
  <dd><% $media->get_published_version || '&nbsp;' %></dd>
  <dt><% $lang->maketext('First Published') %>:</dt>
  <dd><% $media->get_first_publish_date || '&nbsp;' %></dd>
  <dt><% $lang->maketext('Last Published') %>:</dt>
  <dd><% $media->get_publish_date || '&nbsp;' %></dd>
  <dt><% $lang->maketext('Priority') %>:</dt>
  <dd><% $media->get_priority() %></dd>
  <dt><% $lang->maketext('Output Channels') %>:</dt>
  <dd><% join ', ', (map { $_->get_name } $media->get_output_channels) %></dd>
</dl>

<& '/widgets/wrappers/sharky/table_bottom.mc' &>
<& 'file_section.mc', media     => $media,
                      widget    => $widget,
                      num       => 2,
                      read_only => 1,
                      indent    => $infoIndent
&>
<& '/widgets/container_prof/container_prof.mc',
  tile        => $tile,
  tile_type   => 'media',
  action      => 'view',
  num         => 3,
  title       => 'Content',
  start_count => 6
&>

<& '/widgets/wrappers/sharky/table_top.mc',
   caption => "Associations",
   number => 4
&>

<table class="associations">
<tr class="odd">
  <th><% $lang->maketext('Category') %>:</th>
  <td><%perl>
my $cat = $media->get_category;
$m->out($cat->get_name);
</%perl></td>
</tr>
<tr class="even">
  <th><% $lang->maketext('Keywords') %>:</th>
  <td><%perl>
my @keywords;
foreach my $kw ($media->get_keywords) {
    push @keywords, $kw->get_name;
}

$m->out(scalar(@keywords) ? join(", ", @keywords) : $lang->maketext("No keywords defined."));
</%perl></td>
</tr>
<tr class="odd">
  <th><% $lang->maketext('Contributors') %>:</th>
  <td><%perl>
my @contribs;
foreach my $cntr ($media->get_contributors) {
    push @contribs,  $cntr->get_name;
}
$m->out(scalar(@contribs) ? join(", ", @contribs) : $lang->maketext("No contributors defined."));

</%perl></td>
</tr>
</table>
<& '/widgets/wrappers/sharky/table_bottom.mc' &>

<& '/widgets/profile/button.mc',
    disp      => $lang->maketext("Return"),
    widget    => $widget,
    cb        => 'return_cb',
    button    => 'return_dgreen',
    useTable  => 0 &>

<%args>
$widget
</%args>

<%init>
my $media = get_state_data($widget, 'media');
my $id = $media->get_id;
my $tile = $media->get_tile();

set_state_data('container_prof', 'tile', $tile);

my $agent = detect_agent();
my $infoIndent = $agent->nav4 ? FIELD_INDENT - 5 : FIELD_INDENT + 8;
my $num = 1;
</%init>
