<& '/widgets/wrappers/sharky/table_top.mc',
    caption => "Existing Notes",
    number  => $number++ &>

<table class="listManager">
<tr>
    <th width="10%">Version</th>
    <th>Note</th>
</tr>

% foreach my $n (@notes) {
%     if ($flag) {
<tr>
    <td colspan="2" height="1" class="medHeader"><img src="/media/images/spacer.gif" width="1" height="1" /></td>
</tr>
%     } # if
<tr>
    <td class="label"><% $n->{id} %></td>
    <td><% $n->{note} %></td>
%     $flag = 1;
% } # foreach
% unless (@notes) {
<tr>
    <td colspan="2"><%$lang->maketext('No existing notes.')%></td>
</tr>
% } # unless

</table>
<& '/widgets/wrappers/sharky/table_bottom.mc' &>

<& '/widgets/wrappers/sharky/table_top.mc',
    caption => "Current Note",
    number  => $number &>
% my $key = $widget . '|note';
<& '/widgets/profile/displayFormElement.mc',
	key => $key,
	vals => {
		disp => 'Note',
		value => $current,
		props => {
			type => 'textarea',
			cols => 45,
			rows => 4
		}
	}  &>

<input type="hidden" name="return_url" value="<% $return_url %>" />

<& '/widgets/wrappers/sharky/table_bottom.mc' &>

<& '/widgets/profile/button.mc',
    disp    => 'Save',
    widget  => $widget,
    cb      => 'add_note_cb',
    button  => 'save_red',
    useTable => 0 &>
<& '/widgets/profile/button.mc',
    disp    => 'Cancel',
    widget  => $widget,
    cb      => 'return_cb',
    button  => 'cancel_lgreen',
    useTable => 0 &>
<%args>
$widget
$number
</%args>

<%init>;
my $notes = get_state_data($widget, 'notes');
my $version = get_state_data($widget, 'version');
my $return_url = get_state_data($widget, 'return_url');

my $current = delete $notes->{$version};

my @notes = map { { id => $_, note => $notes->{$_} } }
  sort { $notes->{$a} <=> $notes->{$b} } keys %$notes;
my $flag;
</%init>
