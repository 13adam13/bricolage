% if ($frame) {
<& /widgets/wrappers/sharky/table_top.mc,
   caption => $header,
   number  => $number
&>
% }
<div style="float: right;"><% $button %></div>
<dl class="viewmeta">
<dt><% $lang->maketext('ID') %>:</dt>
<dd><% $story->get_id %></dd>
<dt><% $lang->maketext('Title') %>:</dt>
<dd><% $story->get_title %></dd>
<dt><% $lang->maketext('Story Type Element') %>:</dt>
<dd><% $story->get_element_name %></dd>
<dt><% $lang->maketext('First Published') %>:</dt>
<dd><% $story->get_first_publish_date || '&nbsp;' %></dd>
<dt><% $lang->maketext('Last Published') %>:</dt>
<dd><% $story->get_publish_date || '&nbsp;' %></dd>
<dt><% $lang->maketext('URI') %>:</dt>
% if ($is_related_story) {
<dd><% $prim_uri %></dd>
% } else {
%     if (@ocs == 1) {
<dd><a href="/workflow/profile/preview/story/<% $id %>" class="blackUnderlinedLink" target="preview_<% SERVER_WINDOW_NAME %>"><% $prim_uri %></a></dd>
%     } else {
<dd><% $prim_uri %></dd>
<dt><% $lang->maketext('Preview in') %>:</dt>
<dd><% $oc_select %>&nbsp;<a href="#" onClick="window.open('/workflow/profile/preview/story/<% $id %>/' + window.document.theForm.ocSelect.options[window.document.theForm.ocSelect.selectedIndex].value, 'preview_<% SERVER_WINDOW_NAME %>');return false;"><img src="/media/images/<% $lang_key %>/preview_lgreen.gif" alt="Preview" border="0" width="74" height="20"></a></dd>
%     }
% }
</dl>

% if ($frame) {
<& /widgets/wrappers/sharky/table_bottom.mc &>
%}
<%args>
$widget
$header => undef
$number => undef
$frame  => undef
$button => "&nbsp;"
</%args>

<%init>;
my $story = get_state_data($widget, 'asset');
my $cat      = $story->get_primary_category;
my $cat_name = $cat ? $cat->get_name : '';
$header ||= 'Story Information';

# see whether we're at the top of the page or not;
# otherwise, we won't show the "Preview in" line
my $is_related_story = $number != 1;

my $id = $story->get_id();
my $prim_uri = $story->get_primary_uri();
my $agent = detect_agent();
my $infoIndent = $agent->nav4 ? FIELD_INDENT - 5 : FIELD_INDENT + 8;

# get output channel info
my $at = $story->get_element__id();
my $asset_type = Bric::Biz::AssetType->lookup({id => $at});
my @ocs = $asset_type->get_output_channels();

my $oc_select = '<select name="ocSelect">';
my $pocid = $asset_type->get_primary_oc_id($story->get_site_id);
foreach my $oc (@ocs) {
    my $selected = '';
    $selected = ' selected' if $oc->get_id() == $pocid;
    $oc_select .= '<option value="' . $oc->get_id() . '"' . $selected . '>' . $oc->get_name() . '</option>';
}
$oc_select .= '</select>';
</%init>
